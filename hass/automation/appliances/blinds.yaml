---
- alias: Open blinds in the morning
  id: open_blinds_in_the_morning
  trigger:
    - platform: sun
      event: sunrise
      offset: 00:30:00
    - platform: state
      entity_id: climate.main_floor
      attribute: preset_mode
      from: Sleep
      to: Home
  condition:
    - condition: sun
      after: sunrise
      after_offset: 00:30:00
      before: sunset
      before_offset: -00:30:00
    - not:
        condition: state
        entity_id: climate.main_floor
        attribute: preset_mode
        state: Sleep
  action:
    - service: cover.open_cover
      entity_id: group.all_blinds

- alias: Close blinds in the evening
  id: close_blinds_in_the_evening
  trigger:
    - platform: sun
      event: sunset
      offset: -00:30:00
    - platform: state
      entity_id: climate.main_floor
      attribute: preset_mode
      to: Sleep
  action:
    - service: cover.open_cover
      entity_id: group.all_blinds

- alias: Sync living room blinds with TV
  id: sync living room blinds with tv
  trigger:
    - platform: state
      entity_id: remote.salon_tv
  condition:
    - condition: sun
      after: sunrise
      after_offset: 00:30:00
      before: sunset
      before_offset: -00:30:00
  action:
    - service: "cover.{{ 'close' if trigger.to_state.state == 'on' else 'open' }}_cover"
      entity_id: cover.living_room_window_blind

- alias: Sync office blind with sun when working
  id: sync_office_blind_with_sun_when_working
  trigger:
    - platform: time_pattern
      minutes: '/5'  # Checks every 5 minutes; adjust as needed
    - platform: state
      entity_id: binary_sensor.laptop_wifi
      to: "on"
    - platform: state
      entity_id: binary_sensor.laptop_ethernet
      to: "on"
  condition:
    - or:
      - condition: state
        entity_id: binary_sensor.laptop_wifi
        state: "on"
      - condition: state
        entity_id: binary_sensor.laptop_ethernet
        state: "on"
    - condition: numeric_state
      entity_id: sun.sun
      value_template: "{{ state_attr('sun.sun', 'azimuth') }}"
      above: 239
    - condition: numeric_state
      entity_id: sun.sun
      value_template: "{{ state_attr('sun.sun', 'elevation') }}"
      below: 45  # Adjust based on the angle of the sun that affects your screen
    - condition: time
      after: '07:00:00'
      before: '16:00:00'
      weekday:
        - mon
        - wed
        - fri
  action:
    - service: cover.set_cover_position
      data_template:
        entity_id: cover.office_window_blind
        position: >
          {% set azimuth = state_attr('sun.sun', 'azimuth') %}
          {% set position = 100 - ((azimuth - 239) * 0.5) %}
          {{ [0, position] | max }}