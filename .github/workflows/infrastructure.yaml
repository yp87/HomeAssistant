---
name: Infrastructure CI

# yamllint disable-line rule:truthy
on:
  push:
    branches:
      - master
    paths:
      - 'Supervisor/**'
      - 'alarm/**'
      - 'WebhookProxy/**'
      - 'docker-compose*.yaml'
      - '.github/workflows/**'
      - '.stubs/infrastructure/**'
  pull_request:
    branches:
      - master
    paths:
      - 'Supervisor/**'
      - 'alarm/**'
      - 'WebhookProxy/**'
      - 'docker-compose*.yaml'
      - '.github/workflows/**'
      - '.stubs/infrastructure/**'

jobs:
  infrastructure:
    runs-on: ubuntu-latest
    steps:
      - name: Getting repository files
        uses: actions/checkout@v2
        with:
          submodules:
      - name: Copy stub files into configuration folder
        run: cp -R ./.stubs/infrastructure/* ./
      - name: Build the docker-compose stack
        run: >-
          docker-compose
          -f docker-compose.yaml
          -f docker-compose-homeassistant.yaml
          build --parallel
